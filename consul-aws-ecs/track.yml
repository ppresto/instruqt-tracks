slug: consul-aws-ecs-poc
id: enlpvazu1tqe
type: track
title: Consul on AWS
teaser: Consul as a Shared Service on AWS with Consul Enterprise
description: In this track you will set up a Consul shared service on AWS, and connect
  applications across multiple platforms.
icon: https://storage.googleapis.com/instruqt-frontend/assets/hashicorp/tracks/consul.png
tags: []
owner: hashicorp
developers:
- ppresto@hashicorp.com
private: true
published: false
show_timer: true
challenges:
- slug: provision-consul
  id: uyjxdvqk2pbc
  type: challenge
  title: 'Infrastructure: Use Terraform to provision the Consul, & ECS Cluster'
  teaser: Create Consul and ECS Cluster with Terraform
  assignment: "You can think of the Cloud CLI terminal as your laptop machine preloaded
    with your AWS access credentials. <br>\nAt any time you can use the AWS CLI and
    console to view your environment. <br>\n\nLets start by verifying our default
    and custom VPC's (10.0.0.0/16).\n```\naws ec2 describe-vpcs | jq -r '.Vpcs[].CidrBlock'\n```\n\nNext,
    make sure the immutable image we created in the background is available.  Terraform
    will use this image in the next step.\n```\naws ec2 describe-images --region ${AWS_REGION}
    \\\n--filters \"Name=tag:Owner,Values=ppresto@hashicorp.com\" \\\n--output text\n```\n\n#
    Provision Consul\nLets use Terraform to provision a NLB, and ASG using the immutable
    packer image above so we can support now downtime changes and upgrades.\n```\ncd
    /root/consul\nterraform init\nterraform apply -auto-approve\n```\nWhile Terraform
    is provisiong this infrastructure lets take a look at the `terraform` tab and
    inspect /root/consul. <br>\n\nYou should see green terraform outputs if everything
    builds successfully.  Copy the `dns_name` value\nand put this into a new browser
    tab to access the consul UI.  You should see the consul and snapshot services
    \nalong with an ec2 bastion host that consul discovered."
  notes:
  - type: text
    contents: |-
      In this assignment you will familiarize yourself with the AWS cloud
      environment, and provision consul.
  tabs:
  - title: Cloud CLI
    type: terminal
    hostname: cloud-client
  - title: Cloud Consoles
    type: service
    hostname: cloud-client
    path: /
    port: 80
  - title: Current lab setup
    type: website
    url: https://htmlpreview.github.io/?https://raw.githubusercontent.com/ppresto/instruqt-tracks/master/consul-aws-ecs/assets/diagrams/03-provision-consul.html
  - title: Terraform
    type: code
    hostname: cloud-client
    path: /root
  difficulty: basic
  timelimit: 1800
- slug: build-consul-ecs-agent
  id: dmteuxtrwst0
  type: challenge
  title: Init/Sidecar Service Registration
  teaser: To register our ECS services we need to build an init container
  assignment: |-
    To host this container you will need a [dockerhub account](https://hub.docker.com/).
    If you dont already have one sign up for a free account now. <br>

    # Update DockerID
    Go to the `Code` tab or use vi to edit file: `Makefile`.
    Replace the DOCKER_ID (ex: ppresto) with your docker account name and save the file.
    ```
    vi Makefile
    ```

    Go to the `Terminal` tab to build and push your new image
    ```
    make build
    make push
    ```
  notes:
  - type: text
    contents: In this challenge you will build an init/sidecar image used to register
      services to consul.
  tabs:
  - title: Docker
    type: terminal
    hostname: vm
  - title: Cloud Consoles
    type: service
    hostname: cloud-client
    path: /
    port: 80
  - title: Code
    type: code
    hostname: vm
    path: /root/consul-ecs-agent
  difficulty: basic
  timelimit: 1800
- slug: build-ecs-cluster
  id: vdd2lma8ryhh
  type: challenge
  title: ECS Cluster
  teaser: Use Terraform to build and deploy Hashicups in ECS
  assignment: |-
    Update the cluster_name in my.auto.tfvars and verify the region is correct.
    ```
    vi my.auto.tfvars
    ```

    Provision the ECS Cluster
    ```
    terraform init
    terraform apply -auto-approve
    ```
  notes:
  - type: text
    contents: |-
      In this assignment you will build an immutable image of Consul with [HashiCorp Packer](https://packer.io/). <br>

      Immutability has many advantages for infrastructure management.
      Consul Enterprise can take advantage of immutable patterns with [Automated Upgrades](https://www.consul.io/docs/enterprise/upgrades/index.html).
  tabs:
  - title: Editor
    type: code
    hostname: cloud-client
    path: /root/ecs
  - title: Terminal
    type: terminal
    hostname: cloud-client
  - title: Cloud Consoles
    type: service
    hostname: cloud-client
    path: /
    port: 80
  difficulty: basic
  timelimit: 1800
- slug: sandbox
  id: abnujsmdzczv
  type: challenge
  title: Test Consul features
  teaser: sky is the limit
  assignment: Please go back and stop the track once you are done to free up resources.
  notes:
  - type: text
    contents: In this assignment, you are free to do your own consul validation. <br>
  tabs:
  - title: Code
    type: code
    hostname: cloud-client
    path: /root
  - title: Cloud CLI
    type: terminal
    hostname: cloud-client
  - title: Cloud Consoles
    type: service
    hostname: cloud-client
    path: /
    port: 80
  difficulty: basic
  timelimit: 1800
checksum: "1276512918541373246"
